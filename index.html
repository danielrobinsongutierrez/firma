<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Firmas de Correo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .signature-preview {
            font-family: Arial, sans-serif;
            font-size: 12px;
            color: #333;
            line-height: 1.4;
            border-top: 2px solid #e5e7eb;
            padding-top: 15px;
            margin-top: 20px;
        }
        
        .signature-preview .logo {
            max-height: 60px;
            margin-right: 15px;
            vertical-align: middle;
        }
        
        .signature-preview .name {
            font-size: 16px;
            font-weight: bold;
            color: #1f2937;
        }
        
        .signature-preview .position {
            color: #6b7280;
            font-style: italic;
        }
        
        .signature-preview .company {
            font-weight: 600;
            color: #374151;
            margin-bottom: 5px;
        }
        
        .signature-preview .contact {
            color: #4b5563;
        }
        
        .signature-preview .contact a {
            color: #3b82f6;
            text-decoration: none;
        }
        
        .signature-preview .contact a:hover {
            text-decoration: underline;
        }
        
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 16px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .toast.success {
            border-left: 4px solid #10b981;
        }
        
        .toast.error {
            border-left: 4px solid #ef4444;
        }

        .required-field::after {
            content: " *";
            color: #ef4444;
        }

        .invalid-field {
            border-color: #ef4444 !important;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-slate-100 min-h-screen">
    <div class="max-w-7xl mx-auto p-4">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-slate-800 mb-2">
                Generador de Firmas de Correo
            </h1>
            <p class="text-slate-600">
                Crea tu firma, completa los datos requeridos en el formulario
            </p>
        </div>

        <div class="grid lg:grid-cols-2 gap-8">
            <!-- Formulario -->
            <div class="space-y-6">
                <div class="bg-white rounded-lg shadow-sm">
                    <div class="border-b">
                        <nav class="flex -mb-px" role="tablist">
                            <button class="tab-button py-4 px-6 border-b-2 border-blue-500 text-blue-600 font-medium" 
                                    data-tab="personal" 
                                    role="tab" 
                                    aria-selected="true" 
                                    aria-controls="personal-tab">
                                Datos Personales
                            </button>
                            <button class="tab-button py-4 px-6 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium" 
                                    data-tab="template" 
                                    role="tab" 
                                    aria-selected="false" 
                                    aria-controls="template-tab">
                                Configuración Plantilla
                            </button>
                        </nav>
                    </div>
                    
                    <!-- Datos Personales -->
                    <div id="personal-tab" class="tab-content p-6 space-y-4" role="tabpanel" aria-labelledby="personal-tab">
                        <div>
                            <h3 class="text-lg font-semibold flex items-center gap-2 mb-4">
                                <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                                Información Personal
                            </h3>
                            <p class="text-sm text-gray-600 mb-4">
                                Ingresa tus datos personales para la firma
                            </p>
                            
                            <div class="space-y-4">
                                <div>
                                    <label for="fullName" class="block text-sm font-medium text-gray-700 mb-1 required-field">
                                        Nombre Completo
                                    </label>
                                    <input
                                        type="text"
                                        id="fullName"
                                        placeholder="Juan Pérez García"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        required
                                    >
                                    <span class="text-xs text-red-500 hidden" id="fullNameError">Este campo es obligatorio</span>
                                </div>
                                
                                <div>
                                    <label for="position" class="block text-sm font-medium text-gray-700 mb-1 required-field">
                                        Cargo / Puesto
                                    </label>
                                    <input
                                        type="text"
                                        id="position"
                                        placeholder="Gerente de Ventas"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        required
                                    >
                                    <span class="text-xs text-red-500 hidden" id="positionError">Este campo es obligatorio</span>
                                </div>
                                
                                <div>
                                    <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">
                                        Teléfono
                                    </label>
                                    <input
                                        type="text"
                                        id="phone"
                                        placeholder="+34 600 123 456"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    >
                                </div>
                                
                                <div>
                                    <label for="email" class="block text-sm font-medium text-gray-700 mb-1">
                                        Correo Electrónico
                                    </label>
                                    <input
                                        type="email"
                                        id="email"
                                        placeholder="juan.perez"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    >
                                    <p class="text-xs text-gray-500 mt-1">Se añadirá @copelco.coop automáticamente</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Configuración Plantilla -->
                    <div id="template-tab" class="tab-content p-6 space-y-4 hidden" role="tabpanel" aria-labelledby="template-tab">
                        <div>
                            <h3 class="text-lg font-semibold flex items-center gap-2 mb-4">
                                <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                                Configuración de la Plantilla
                            </h3>
                            <p class="text-sm text-gray-600 mb-4">
                                Configura los datos de tu empresa (se guardará en el navegador para futuros usos)
                            </p>
                            
                            <div class="space-y-4">
                                <div>
                                    <label for="companyName" class="block text-sm font-medium text-gray-700 mb-1">
                                        Nombre de la Empresa
                                    </label>
                                    <input
                                        type="text"
                                        id="companyName"
                                        placeholder="Coop. Copelco ltda"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    >
                                </div>
                                
                                <div>
                                    <label for="website" class="block text-sm font-medium text-gray-700 mb-1">
                                        Sitio Web
                                    </label>
                                    <input
                                        type="text"
                                        id="website"
                                        placeholder="https://www.copelco.coop"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    >
                                </div>
                                
                                <div>
                                    <label for="logo" class="block text-sm font-medium text-gray-700 mb-1">
                                        URL del Logo
                                    </label>
                                    <input
                                        type="text"
                                        id="logo"
                                        placeholder="https://copelco.coop/storage/images/deco/logo-copelco.svg"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    >
                                    <p class="text-xs text-gray-500 mt-1">Para imágenes de dominios externos, asegúrate de que permitan CORS</p>
                                </div>
                                
                                <div>
                                    <label for="address" class="block text-sm font-medium text-gray-700 mb-1">
                                        Dirección
                                    </label>
                                    <textarea
                                        id="address"
                                        placeholder="Av. J. A. Roca 758"
                                        rows="2"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    ></textarea>
                                </div>
                                
                                <button id="saveTemplate" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors">
                                    <i class="fas fa-save mr-2"></i>
                                    Guardar Configuración
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Vista Previa -->
            <div class="space-y-6">
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h3 class="text-lg font-semibold flex items-center gap-2 mb-4">
                        <i class="fas fa-eye"></i>
                        Vista Previa
                    </h3>
                    <p class="text-sm text-gray-600 mb-4">
                        Así se verá tu firma en el correo electrónico
                    </p>
                    
                    <div class="bg-white border rounded-lg p-6 min-h-[200px]">
                        <div id="signaturePreview">
                            <div class="text-center text-gray-400 py-8">
                                <p>Completa los datos para ver la vista previa</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h3 class="text-lg font-semibold mb-4">Acciones</h3>
                    <p class="text-sm text-gray-600 mb-4">
                        Descarga la imagen de tu firma o copia el HTML
                    </p>
                    
                    <div class="space-y-4">
                        <button id="downloadImage" class="w-full bg-green-600 text-white py-3 px-4 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors border-2 border-green-700">
                            <i class="fas fa-download mr-2"></i>
                            Descargar Imagen de la Firma
                        </button>
                        
                        <button id="copyHTML" class="w-full bg-purple-600 text-white py-3 px-4 rounded-md hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition-colors border-2 border-purple-700">
                            <i class="fas fa-copy mr-2"></i>
                            Copiar HTML de la Firma
                        </button>
                        
                        <hr class="my-4">
                        
                        <div class="text-sm text-gray-600">
                            <p class="font-medium mb-2">Instrucciones:</p>
                            <ul class="space-y-1 text-xs">
                                <li>• Completa tus datos personales (obligatorios)</li>
                                <li>• Configura la plantilla de tu empresa</li>
                                <li>• Descarga la imagen o copia el HTML</li>
                                <li>• Usa la firma en tu cliente de correo</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast" role="alert" aria-live="assertive">
        <div class="flex items-center">
            <div id="toastIcon" class="mr-3"></div>
            <div>
                <div id="toastTitle" class="font-medium"></div>
                <div id="toastMessage" class="text-sm text-gray-600"></div>
            </div>
        </div>
    </div>

    <script>
        // Elementos del DOM
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');
        const personalTab = document.getElementById('personal-tab');
        const templateTab = document.getElementById('template-tab');
        const downloadButton = document.getElementById('downloadImage');
        const copyHTMLButton = document.getElementById('copyHTML');
        const saveButton = document.getElementById('saveTemplate');
        const signaturePreview = document.getElementById('signaturePreview');
        const toast = document.getElementById('toast');
        
        // Campos del formulario
        const fullNameInput = document.getElementById('fullName');
        const positionInput = document.getElementById('position');
        const phoneInput = document.getElementById('phone');
        const emailInput = document.getElementById('email');
        const companyNameInput = document.getElementById('companyName');
        const websiteInput = document.getElementById('website');
        const logoInput = document.getElementById('logo');
        const addressInput = document.getElementById('address');
        
        // Mensajes de error
        const fullNameError = document.getElementById('fullNameError');
        const positionError = document.getElementById('positionError');

        // Establecer valores por defecto al cargar la página
        function setDefaultValues() {
            companyNameInput.value = 'Coop. Copelco ltda';
            logoInput.value = 'https://copelco.coop/storage/images/deco/logo-copelco.svg';
            addressInput.value = 'Av. J. A. Roca 758';
        }

        // Cargar plantilla guardada
        function loadTemplate() {
            const savedTemplate = localStorage.getItem('emailSignatureTemplate');
            if (savedTemplate) {
                const template = JSON.parse(savedTemplate);
                companyNameInput.value = template.companyName || 'Coop. Copelco ltda';
                websiteInput.value = template.website || '';
                logoInput.value = template.logo || 'https://github.com/danielrobinsongutierrez/firma/blob/main/logo-copelco.png';
                addressInput.value = template.address || 'Av. J. A. Roca 758';
            } else {
                // Valores por defecto si no hay plantilla guardada
                setDefaultValues();
            }
            updatePreview();
        }

        // Guardar plantilla
        function saveTemplate() {
            const template = {
                companyName: companyNameInput.value,
                website: websiteInput.value,
                logo: logoInput.value,
                address: addressInput.value
            };
            
            localStorage.setItem('emailSignatureTemplate', JSON.stringify(template));
            showToast('¡Guardado!', 'La configuración de la plantilla ha sido guardada.', 'success');
        }

        // Validar formulario
        function validateForm() {
            let isValid = true;
            
            // Validar nombre completo
            if (!fullNameInput.value.trim()) {
                fullNameInput.classList.add('invalid-field');
                fullNameError.classList.remove('hidden');
                isValid = false;
            } else {
                fullNameInput.classList.remove('invalid-field');
                fullNameError.classList.add('hidden');
            }
            
            // Validar posición
            if (!positionInput.value.trim()) {
                positionInput.classList.add('invalid-field');
                positionError.classList.remove('hidden');
                isValid = false;
            } else {
                positionInput.classList.remove('invalid-field');
                positionError.classList.add('hidden');
            }
            
            return isValid;
        }

        // Cambiar entre pestañas
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const targetTab = button.getAttribute('data-tab');
                
                // Actualizar botones
                tabButtons.forEach(btn => {
                    btn.classList.remove('border-blue-500', 'text-blue-600');
                    btn.classList.add('border-transparent', 'text-gray-500');
                    btn.setAttribute('aria-selected', 'false');
                });
                button.classList.remove('border-transparent', 'text-gray-500');
                button.classList.add('border-blue-500', 'text-blue-600');
                button.setAttribute('aria-selected', 'true');
                
                // Actualizar contenido
                tabContents.forEach(content => {
                    content.classList.add('hidden');
                });
                
                if (targetTab === 'personal') {
                    personalTab.classList.remove('hidden');
                } else {
                    templateTab.classList.remove('hidden');
                }
            });
        });

        // Generar HTML de la firma
        function generateSignatureHTML() {
            const fullName = fullNameInput.value;
            const position = positionInput.value;
            const phone = phoneInput.value;
            const email = emailInput.value;
            const companyName = companyNameInput.value;
            const website = websiteInput.value;
            const logo = logoInput.value;
            const address = addressInput.value;
            
            const logoHTML = logo 
                ? `<img src="${logo}" alt="${companyName}" class="logo">`
                : "";

            return `
                <div class="signature-preview">
                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                        ${logoHTML}
                        <div>
                            <div class="name">${fullName}</div>
                            <div class="position">${position}</div>
                        </div>
                    </div>
                    ${companyName ? `<div class="company">${companyName}</div>` : ""}
                    <div class="contact">
                        ${phone ? `<div><i class="fas fa-phone"></i> ${phone}</div>` : ""}
                        ${email ? `<div><i class="fas fa-envelope"></i> ${email}</div>` : ""}
                        ${website ? `<div><i class="fas fa-globe"></i> <a href="${website}">${website}</a></div>` : ""}
                        ${address ? `<div><i class="fas fa-map-marker-alt"></i> ${address}</div>` : ""}
                    </div>
                </div>
            `;
        }

        // Actualizar vista previa con debounce
        function debounce(func, wait) {
            let timeout;
            return function(...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), wait);
            };
        }

        function updatePreview() {
            const fullName = fullNameInput.value;
            const position = positionInput.value;
            
            if (fullName || position) {
                signaturePreview.innerHTML = generateSignatureHTML();
            } else {
                signaturePreview.innerHTML = `
                    <div class="text-center text-gray-400 py-8">
                        <p>Completa los datos para ver la vista previa</p>
                    </div>
                `;
            }
        }

        const debouncedUpdatePreview = debounce(updatePreview, 300);

        // Forzar actualización inicial para mostrar los valores por defecto
        function forceInitialUpdate() {
            // Mostrar vista previa con datos de la empresa aunque no haya datos personales
            const hasCompanyData = companyNameInput.value || logoInput.value || addressInput.value;
            
            if (hasCompanyData) {
                signaturePreview.innerHTML = generateSignatureHTML();
            }
        }

        // Calcular altura dinámica del canvas
        function calculateCanvasHeight() {
            let height = 120; // Altura base para nombre y posición
            
            if (companyNameInput.value) height += 25;
            if (phoneInput.value) height += 20;
            if (emailInput.value) height += 20;
            if (websiteInput.value) height += 20;
            if (addressInput.value) height += 20;
            
            return height + 40; // Margen adicional
        }

        // Función para cargar imagen con manejo de CORS
        function loadImageWithCORS(url) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.crossOrigin = 'Anonymous'; // Importante para CORS
                img.onload = () => resolve(img);
                img.onerror = () => {
                    // Si falla CORS, intentar sin crossOrigin
                    const img2 = new Image();
                    img2.onload = () => resolve(img2);
                    img2.onerror = () => reject(new Error('No se pudo cargar la imagen'));
                    img2.src = url;
                };
                img.src = url;
            });
        }

        // Descargar imagen de la firma
        async function downloadSignatureImage() {
            if (!validateForm()) {
                return;
            }
            
            const fullName = fullNameInput.value || 'Tu Nombre';
            const position = positionInput.value || 'Tu Cargo';
            const phone = phoneInput.value;
            const email = emailInput.value;
            const companyName = companyNameInput.value;
            const website = websiteInput.value;
            const logo = logoInput.value;
            const address = addressInput.value;

            // Crear un canvas para generar la imagen
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Configurar dimensiones del canvas
            canvas.width = 600;
            canvas.height = calculateCanvasHeight();
            
            // Fondo blanco
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Configurar fuente
            ctx.fillStyle = '#333333';
            ctx.font = '16px Arial';
            
            let yOffset = 30;
            
            // Función para dibujar el resto de la firma
            function drawRestOfSignature() {
                // Dibujar línea separadora
                ctx.strokeStyle = '#e5e7eb';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(20, yOffset);
                ctx.lineTo(canvas.width - 20, yOffset);
                ctx.stroke();
                
                yOffset += 25;
                
                // Dibujar nombre de la empresa
                if (companyName) {
                    ctx.fillStyle = '#374151';
                    ctx.font = 'bold 14px Arial';
                    ctx.fillText(companyName, 20, yOffset);
                    yOffset += 25;
                }
                
                // Dibujar información de contacto
                ctx.fillStyle = '#4b5563';
                ctx.font = '12px Arial';
                
                if (phone) {
                    ctx.fillText('📞 ' + phone, 20, yOffset);
                    yOffset += 20;
                }
                
                if (email) {
                    ctx.fillText('✉️ ' + email, 20, yOffset);
                    yOffset += 20;
                }
                
                if (website) {
                    ctx.fillStyle = '#3b82f6';
                    ctx.fillText('🌐 ' + website, 20, yOffset);
                    yOffset += 20;
                    ctx.fillStyle = '#4b5563';
                }
                
                if (address) {
                    ctx.fillText('📍 ' + address, 20, yOffset);
                }
                
                // Descargar la imagen
                downloadCanvas();
            }
            
            // Cargar y dibujar logo si existe
            if (logo) {
                try {
                    const img = await loadImageWithCORS(logo);
                    
                    // Dibujar logo con tamaño máximo de 60px de altura
                    const logoHeight = 60;
                    const logoWidth = (img.width * logoHeight) / img.height;
                    ctx.drawImage(img, 20, yOffset - 10, logoWidth, logoHeight);
                    
                    // Dibujar nombre y posición al lado del logo
                    ctx.fillStyle = '#1f2937';
                    ctx.font = 'bold 18px Arial';
                    ctx.fillText(fullName, logoWidth + 50, yOffset + 10);
                    
                    ctx.fillStyle = '#6b7280';
                    ctx.font = 'italic 14px Arial';
                    ctx.fillText(position, logoWidth + 50, yOffset + 35);
                    
                    yOffset += 60;
                    
                    // Continuar con el resto de la información
                    drawRestOfSignature();
                } catch (error) {
                    console.error('Error al cargar el logo:', error);
                    showToast('Error', 'No se pudo cargar el logo. La firma se generará sin logo.', 'error');
                    drawSignatureWithoutLogo();
                }
            } else {
                drawSignatureWithoutLogo();
            }
            
            function drawSignatureWithoutLogo() {
                // Dibujar nombre y posición
                ctx.fillStyle = '#1f2937';
                ctx.font = 'bold 18px Arial';
                ctx.fillText(fullName, 20, yOffset + 10);
                
                ctx.fillStyle = '#6b7280';
                ctx.font = 'italic 14px Arial';
                ctx.fillText(position, 20, yOffset + 35);
                
                yOffset += 60;
                drawRestOfSignature();
            }
            
            function downloadCanvas() {
                canvas.toBlob(function(blob) {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'firma-correo.png';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    showToast('¡Descargado!', 'La imagen de la firma ha sido descargada.', 'success');
                }, 'image/png');
            }
        }

        // Copiar HTML al portapapeles
        function copySignatureHTML() {
            if (!validateForm()) {
                return;
            }
            
            const html = generateSignatureHTML();
            navigator.clipboard.writeText(html)
                .then(() => showToast('¡Copiado!', 'El HTML de la firma ha sido copiado al portapapeles.', 'success'))
                .catch(() => showToast('Error', 'No se pudo copiar el HTML', 'error'));
        }

        // Mostrar notificación
        function showToast(title, message, type = 'success') {
            const toastTitle = document.getElementById('toastTitle');
            const toastMessage = document.getElementById('toastMessage');
            const toastIcon = document.getElementById('toastIcon');
            
            toastTitle.textContent = title;
            toastMessage.textContent = message;
            
            // Configurar icono
            if (type === 'success') {
                toastIcon.innerHTML = '<i class="fas fa-check-circle text-green-500"></i>';
                toast.className = 'toast success show';
            } else {
                toastIcon.innerHTML = '<i class="fas fa-exclamation-circle text-red-500"></i>';
                toast.className = 'toast error show';
            }
            
            // Ocultar después de 3 segundos
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Event listeners con debounce
        fullNameInput.addEventListener('input', debouncedUpdatePreview);
        positionInput.addEventListener('input', debouncedUpdatePreview);
        phoneInput.addEventListener('input', debouncedUpdatePreview);
        emailInput.addEventListener('input', debouncedUpdatePreview);
        companyNameInput.addEventListener('input', debouncedUpdatePreview);
        websiteInput.addEventListener('input', debouncedUpdatePreview);
        logoInput.addEventListener('input', debouncedUpdatePreview);
        addressInput.addEventListener('input', debouncedUpdatePreview);
        
        // Precargar dominio del correo
        emailInput.addEventListener('blur', function() {
            if (this.value && !this.value.includes('@')) {
                this.value = this.value + '@copelco.coop';
                debouncedUpdatePreview();
            }
        });
        
        downloadButton.addEventListener('click', downloadSignatureImage);
        copyHTMLButton.addEventListener('click', copySignatureHTML);
        saveButton.addEventListener('click', saveTemplate);

        // Inicializar cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', function() {
            setDefaultValues();
            loadTemplate();
            // Forzar actualización inicial para mostrar vista previa con datos por defecto
            setTimeout(forceInitialUpdate, 100);
        });
    </script>
</body>
</html>
